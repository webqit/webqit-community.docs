
	

	<template name="bundling">
		<div exportgroup="readme">

			<h1 id="bundling">Bundling</h1>
<p>Namespaces in the HTML Partials system can be implemented in a folder-based layout. Here, templates are defined in stand-alone HTML files placed in a hierarchy of folders on the server.</p>
<p>The following <em>article</em> templates can be redefined as standalone files as shown:</p>
<pre><code class="hljs html language-html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">is</span>=<span class="hljs-string">"partials-bundle"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"html/templates/article/readonly"</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"html/templates/article/editable"</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></code></pre>
<pre><code class="hljs html language-html">templates
  |-- article
    |-- readonly.html
    |-- editable.html</code></pre>
<p>The <em>namespace</em> attribute is not needed for templates in a file; a template's namespace is naturally the combination of its path and filename.</p>
<p>file://templates/article/readonly.html</p>
<pre><code class="hljs html language-html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></code></pre>
<p>file://templates/article/editable.html</p>
<pre><code class="hljs html language-html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></code></pre>
<p>To put all our templates back into one file, we would need to <em>bundle</em> them. This time, namespaces would be automatically derived and assigned to each template based on their file location. All of this can be automated using the nodejs-based <em>Bundler</em> utility.</p>
<h2 id="usage">Usage</h2>
<pre><code class="hljs js language-js"><span class="hljs-keyword">import</span> Bundler <span class="hljs-keyword">from</span> <span class="hljs-string">'@web-native-js/chtml/src/html-partials/Bundler.js'</span>;
<span class="hljs-keyword">const</span> bundler = <span class="hljs-keyword">new</span> Bundler(entry[, params = {}]);</code></pre>
<p>Above, <code>entry</code> is the base directory for template files. Files are scanned recursively from here into subdirectories and are bundled each with a namespace that reflects their location. The optional <code>params</code> parameter provides additional configuration for the instance.</p>
<p>To get the bundled contents as string, call the <code>output()</code> method.</p>
<pre><code class="hljs js language-js"><span class="hljs-keyword">var</span> bundleContent = bundler.output();</code></pre>
<p>To save the contents to a file, provide the destination file to the <code>output()</code> method; this can be an absolute path or a relative path – relative to the bundle <code>entry</code> given initially.</p>
<pre><code class="hljs js language-js">bundler.output(outputFile);</code></pre>
<p>The <code>Bundler.bundle()</code> function may also be used</p>
<pre><code class="hljs js language-js">Bundler.bundle(entry[, outputFile[, params]]);</code></pre>
<p>Let's demonstrate this with the sample file structure below.</p>
<pre><code class="hljs html language-html">root
  |-- project-files
  |  |-- templates
  |  |  |-- article
  |  |    |-- readonly.html
  |  |    |-- editable.html
  |  |-- page1.html
  |  |-- page2.html
  |-- public-folder</code></pre>
<p>Now we bundle the files in the <code>project-files</code> directory into <code>public-folder</code>.</p>
<pre><code class="hljs js language-js"><span class="hljs-keyword">const</span> bundler = <span class="hljs-keyword">new</span> Bundler(<span class="hljs-string">'/root/project-files/'</span>);
bundler.output(<span class="hljs-string">'/root/public-folder/bundle.html'</span>);</code></pre>
<p>This file can now be loaded as a CHTML bundle.</p>
<pre><code class="hljs html language-html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">is</span>=<span class="hljs-string">"partials-bundle"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"public-folder/bundle.html"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></code></pre>
<p>On checking the bundle, you will notice that the namespace of each module is prefixed with the extension name of their original file. Here's how that could look:</p>
<pre><code class="hljs html language-html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"html/templates/article/readonly"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"html/templates/article/editable"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"html/page1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"html/page2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></code></pre>
<h2 id="bundling-from-multiple-entries">Bundling From Multiple Entries</h2>
<p>To create multiple bundles from multiple entries, use the static <code>Bundler.bundle()</code> method. This method accepts a list of entries as an object and returns an object with each bundle name mapped to their respective bundle content.</p>
<pre><code class="hljs js language-js"><span class="hljs-keyword">var</span> bundles = Bundler.bundle({
    <span class="hljs-attr">images</span>: <span class="hljs-string">'project-files/images/'</span>,
    <span class="hljs-attr">template</span>: <span class="hljs-string">'project-files/templates/'</span>,
});
<span class="hljs-built_in">console</span>.log(bundles.images);</code></pre>
<p>To save all bundles to a common public directory, provide an output file path as a second argument to <code>Bundler.bundle()</code>.</p>
<pre><code class="hljs js language-js">Bundler.bundle({
    <span class="hljs-attr">images</span>: <span class="hljs-string">'project-files/images/'</span>,
    <span class="hljs-attr">templates</span>: <span class="hljs-string">'project-files/templates/'</span>,
}, <span class="hljs-string">'/public-folder/[name].bundle.html'</span>);</code></pre>
<p>Notice the <code>[name]</code> placeholder in the destination filename. For each of the bundles, this placeholder is replaced with the unique bundle name. So, while all bundles are saved to <code>/public-folder/</code>, each bundle is saved with a unique filename. (If a placeholder is not in the given template file path, something bad happens – each bundle is saved to the same file and previous bundles are overwritten!)</p>
<p>We can now load each bundle.</p>
<pre><code class="hljs html language-html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">is</span>=<span class="hljs-string">"partials-bundle"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"public-folder/images.bundle.html"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">is</span>=<span class="hljs-string">"partials-bundle"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"public-folder/templates.bundle.html"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></code></pre>
<h2 id="bundling-assets">Bundling Assets</h2>
<p>While HTML modules are created by reading the file's contents, assets, like images, are handled differently. These files are copied from their location into the output directory where the regular bundles are located. An appropriate HTML element that points to this new location is automatically generated in the bundle. This is illustrated below.</p>
<p>This is the normal file structure. It now contains an image.</p>
<pre><code class="hljs html language-html">root
  |-- project-files
  |  |-- templates
  |  |  |-- article
  |  |    |-- readonly.html
  |  |    |-- editable.html
  |  |-- images
  |  |  |-- image1.png
  |  |-- page1.html
  |  |-- page2.html
  |-- public-folder</code></pre>
<p>Let's bundle the files in the <code>project-files</code> directory.</p>
<pre><code class="hljs js language-js"><span class="hljs-keyword">const</span> bundler = <span class="hljs-keyword">new</span> Bundler(<span class="hljs-string">'/root/project-files/'</span>);
bundler.output(<span class="hljs-string">'/root/public-folder/bundle.html'</span>);</code></pre>
<p>Now the image at <code>/root/project-files/images/image1.png</code> will now be copied to <code>/root/public-folder/images/image1.png</code> and an <code>&lt;img&gt;</code> element pointing to this new location is added to the bundle.</p>
<p>This is the new file structure:</p>
<pre><code class="hljs html language-html">root
  |-- project-files
  |  |-- templates
  |  |  |-- article
  |  |    |-- readonly.html
  |  |    |-- editable.html
  |  |-- images
  |  |  |-- image1.png
  |  |-- page1.html
  |  |-- page2.html
  |-- public-folder
     |-- images
     |  |-- image1.png
     |-- bundle.html</code></pre>
<p>And our <code>bundle.html</code> should look like this:</p>
<pre><code class="hljs html language-html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"html/templates/article/readonly"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"html/templates/article/editable"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"png/images/image1"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"images/image1.png"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"html/page1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"html/page2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></code></pre>
<p>In another way, it is possible to bundle small images (or other media) in <em>data-URL</em> format. This way, the browser won't have to load them via HTTP request. Cutting down on the number of assets to load should greatly speed up the site's load time.</p>
<p>The Bundler just needs to know at what file size to use the <em>data-URL</em> format. Set the <code>params.maxDataURLsize</code> to a size measured in bytes.</p>
<pre><code class="hljs js language-js">Bundler.bundle(<span class="hljs-string">'/root/project-files'</span>, <span class="hljs-string">'../public-folder/bundle.html'</span>, {<span class="hljs-attr">maxDataURLsize</span>: <span class="hljs-number">1024</span>});</code></pre>
<p>Media files lower than <code>1024</code> in size will now be bundled in <em>data-URL</em> format. The bundled asset should now look like this:</p>
<pre><code class="hljs html language-html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"png/images/image1"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"data:image/png,%89PNG%0D%0A="</span> /&gt;</span></code></pre>
<h2 id="additional-customization">Additional Customization</h2>
<p>The <code>params</code> parameter can be used to influence the way modules are bundled.</p>
<ul>
<li><p>By default, a module's derived namespace path is set on the <code>namespace</code> attribute. To change this, use the <code>params.namespaceKey</code> parameter. But take note that this also has to be same value with HTML Partials's <a href="/chtml/html-partials/README.md#htmltransport-configuration"><code>ENV.params.namespaceAttribute</code></a> parameter.</p>
<pre><code class="hljs js language-js">Bundler.bundle(<span class="hljs-string">'/root/project-files'</span>, <span class="hljs-string">'../public-folder/bundle.html'</span>, {<span class="hljs-attr">namespaceKey</span>: <span class="hljs-string">'ns'</span>});</code></pre>
<pre><code class="hljs html language-html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">ns</span>=<span class="hljs-string">"html/templates/article/readonly"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">ns</span>=<span class="hljs-string">"html/templates/article/editable"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">ns</span>=<span class="hljs-string">"png/images/image1"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"images/image1.png"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">ns</span>=<span class="hljs-string">"html/page1"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">na</span>=<span class="hljs-string">"html/page2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></code></pre></li>
<li><p>It is possible to inplement a different pattern for namespace paths. To do this, provide a callback function on <code>params.namespaceCallback</code>. For each module being processed, this function will recieve the module's file information and should return an appropriate namespace.</p>
<pre><code class="hljs js language-js">Bundler.bundle(<span class="hljs-string">'/root/project-files'</span>, <span class="hljs-string">'../public-folder/bundle.html'</span>, {
    <span class="hljs-attr">namespaceCallback</span>: <span class="hljs-function">(<span class="hljs-params">path, filenameWithoutExt, fileExt</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> (fileExt ? fileExt.replace(<span class="hljs-string">'.'</span>, <span class="hljs-string">''</span>) + <span class="hljs-string">'/'</span> : <span class="hljs-string">''</span>) + filenameWithoutExt.replace(<span class="hljs-regexp">/\\/g</span>, <span class="hljs-string">'/'</span>);
    }
});</code></pre></li>
</ul>
<h2 id="bundling-with-an-npm-script">Bundling With an NPM Script</h2>
<p>Using npm scripts, we could easily run our bundler setup from the command line. All we need to do is to place our bundler script in a place relative to our project's <em>package.json</em> file. The folder structure could look like this:</p>
<pre><code class="hljs html language-html">root
  |-- project-files
  |  |-- templates
  |  |  |-- article
  |  |    |-- readonly.html
  |  |    |-- editable.html
  |  |-- images
  |  |  |-- image1.png
  |  |-- page1.html
  |  |-- page2.html
  |-- public-folder
  |-- bundler-setup.js
  |-- package.json</code></pre>
<p>Here's our bundler script.</p>
<p>file://root/bundler-setup.js</p>
<pre><code class="hljs js language-js"><span class="hljs-keyword">const</span> bundler = <span class="hljs-keyword">new</span> Bundler(<span class="hljs-string">'project-files/'</span>);
bundler.output(<span class="hljs-string">'public-folder/bundle.html'</span>);</code></pre>
<p>And here's our <em>package.json</em> file.</p>
<p>file://root/package.json</p>
<pre><code class="hljs json language-json">{
  <span class="hljs-attr">"nane"</span>: <span class="hljs-string">"project-name"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"0.0.0"</span>,
  <span class="hljs-attr">"scripts"</span>: {
    <span class="hljs-attr">"test"</span>: <span class="hljs-string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,
    <span class="hljs-attr">"bundle"</span>: <span class="hljs-string">"node ./bundler-setup.js"</span>
  }
}</code></pre>
<p>Now from the command line:</p>
<pre><code class="hljs shell language-shell">npm run bundle</code></pre>

		</div>
	</template>

	<div exportgroup="readme">

		<h1 id="oohtml-cli">OOHTML CLI</h1>
<!-- BADGES/ -->
<p><span class="badge-npmversion"><a href="https://npmjs.org/package/@webqit/oohtml-cli" title="View this project on NPM"><img src="https://img.shields.io/npm/v/@webqit/oohtml-cli.svg" alt="NPM version" /></a></span><br />
<span class="badge-npmdownloads"><a href="https://npmjs.org/package/@webqit/oohtml-cli" title="View this project on NPM"><img src="https://img.shields.io/npm/dm/@webqit/oohtml-cli.svg" alt="NPM downloads" /></a></span></p>
<!-- /BADGES -->
<p><em><a href="https://webqit.io/tooling/oohtml-cli">OOHTML CLI</a></em> is a Command-Line utility for OOHTML development.</p>
<blockquote>
  <p><a href="https://github.com/webqit/oohtml-cli">Visit this project on GitHub</a>.</p>
</blockquote>
<h2 id="installation">Installation</h2>
<p>Install OOHTML-CLI globally via npm</p>
<pre><code class="hljs text language-text">$ <span class="hljs-built_in">npm</span> i -g <span class="hljs-built_in">npm</span>
$ <span class="hljs-built_in">npm</span> i -g @webqit/oohtml-cli</code></pre>
<h2 id="commands">Commands</h2>
<p>View all available commands and their descriptions:</p>
<pre><code class="hljs text language-text"><span class="hljs-meta">$</span><span class="bash"> oohtml <span class="hljs-built_in">help</span></span></code></pre>
<ul>
<li><p><strong>Config</strong> - Configure the behaviour of a command:</p>
<pre><code class="hljs text language-text">$ oohtml<span class="hljs-built_in"> config </span>&lt;command&gt;</code></pre>
<p>…where <code>&lt;command&gt;</code> is the command name to configure. Use the the ellipsis <code>...</code> for options.</p></li>
<li><p><strong>Bundle</strong> - Run the HTML Bundler:</p>
<pre><code class="hljs text language-text"><span class="hljs-variable">$ </span>oohtml bundle</code></pre>
<p>See <a href="bundling/README.md">Bundler Docs</a> for API details.</p></li>
</ul>
<h2 id="issues">Issues</h2>
<p>To report bugs or request features, please submit an <a href="https://github.com/webqit/oohtml-cli/issues">issue</a>.</p>
<h2 id="license">License</h2>
<p>MIT.</p>

	</div>
